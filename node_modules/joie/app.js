'use strict';

/*========================================================================================
    Require Snap
========================================================================================*/
var settings = require('./settings');
var Snap = require('@trackif/snap');
var snap = new Snap(settings);

/*========================================================================================
    Define Apps
========================================================================================*/
var app = snap.app('Main', 'models, jQuery', function(models, $) {

    /*========================================================================================
        PDPs
    ========================================================================================*/
    function addPDPFavorite() {

        var options = new models.Button();

        options.text.tooltipTrack = 'Add to Favorites';
        options.text.tooltipUntrack = 'Remove favorite';

        options.modal.text.title = 'Add to Favorites';
        options.modal.text.message = 'Sign up for Favorites and get new product, availability and special offer alerts!';
        options.modal.text.button.tracked = '';

        snap.attach({
            selector: '.product-name h1',
            module: 'tif-favorite',
            options: options,
            page: 'product',
            type: 'product-favorite'
        });

    }

    /*========================================================================================
        Category Pages
    ========================================================================================*/
    function addCategoryFavorite() {

        var options = new models.Button();

        options.modal.text.title = 'Add to Favorites';
        options.modal.text.message = 'Sign up for Favorites and get new product, availability and special offer alerts!';
        options.modal.text.button.tracked = '';

        options.text.tooltipTrack = 'Add to Favorites';
        options.text.tooltipUntrack = 'Remove favorite';

        snap.attach({
            selector: '.breadcrumbs h1',
            module: 'tif-favorite',
            options: options,
            page: 'category',
            type: 'category-favorite'
        });

    }

    /*========================================================================================
        Search Pages
    ========================================================================================*/
    function addSearchFavorite() {

        var options = new models.Button();

        options.modal.text.title = 'Add to Favorites';
        options.modal.text.message = 'Sign up for Favorites and get new product, availability and special offer alerts!';
        options.modal.text.button.tracked = '';

        options.text.tooltipTrack = 'Add to Favorites';
        options.text.tooltipUntrack = 'Remove favorite';

        snap.attach({
            selector: '.page-title h1',
            module: 'tif-favorite',
            options: options,
            page: 'search',
            type: 'search-favorite'
        });

    }

    /*========================================================================================
        Multiple product favorites
    ========================================================================================*/
    function addMultipleProductFavorites() {

        var options = new models.Button();

        options.url = function () {

            return this.$root.parent().parent().attr('href');
            
        };

        options.modal.text.button.tracked = '';
        options.modal.text.title = 'Add to Favorites';
        options.modal.text.message = function () {
            
            return 'Sign up for Favorites and get new product, availability and special offer alerts!';
        
        };

        options.text.tooltipTrack = 'Add to Favorites';
        options.text.tooltipUntrack = 'Remove favorite';

        snap.attach({
            selector: '.category-products .item .product-name',
            module: 'tif-favorite',
            options: options,
            page: 'multiple',
            type: 'multiple-product-favorite'
        });

    }

    /*========================================================================================
        Manage Alerts
    ========================================================================================*/
    function addManageAlerts() {

        var options = new models.Button();
        
        options.text.track = 'Manage Alerts';
        options.type = 'link';
        options.modal.text.title = 'Manage Alerts';
        options.modal.text.message = 'Manage alerts for your favorite products.';
        options.modal.list = snap.getTrackList;
        options.modal.thumbnail = 'http://smcdn.joie.com/skin/frontend/joie/joie/images/logo.svg';

        snap.attach({
            
            selector: function (tag) {
                
                return $(tag).appendTo('.switches:first');

            },

            module: 'tif-manage-alerts-button',
            options: options,
            page: 'manage-alerts',
            type: 'manage-alerts'
        });

    }

    /*========================================================================================
        Tasks
    ========================================================================================*/
    this.registerTask('Product Favorite', addPDPFavorite, 'Adds favorites to product detail page.');
    this.registerTask('Category Favorite', addCategoryFavorite, 'Add favorite to a category.');
    this.registerTask('Search Favorite', addSearchFavorite, 'Add favorite to a search.');
    this.registerTask('Multiple Product Favorites', addMultipleProductFavorites, 'Adds favorites to each product on category or search pages.');
    this.registerTask('Manage Alerts', addManageAlerts, 'Adds manage alerts to header of all pages.');

    /*========================================================================================
        Scenes
    ========================================================================================*/
    this.addScene(
        'Product', [
            '.catalog-product-view'
        ], [
            'Product Favorite'
        ]
    );

    this.addScene(
        'Category', [
            '.catalog-category-view'
        ], [
            'Category Favorite',
            'Multiple Product Favorites'
        ]
    );

    this.addScene(
        'Search', [
            /\/nsearch\//i,
            '.category-products'
        ], [
            'Search Favorite',
            'Multiple Product Favorites'
        ]
    );

    this.addScene(
        'Manage Alerts', [
            /.*/i
        ], [
            'Manage Alerts'
        ]
    );

});

/*========================================================================================
    Run App
========================================================================================*/
snap.run(app);
